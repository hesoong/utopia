---
title: Openwrt + Tplink ACAP deploy
date: 2023-06-04 15:15:45
updated: 2023-06-04
toc: true
tags:
  - 网络
  - 家庭组网
---

## 前言

> 最近想把家里网络升级一下 于是购置了一套Tplink APAC 组网设备
> 家里已有网络环境 光纤入户-> 一台N3540主路由（拨号&DHCP）-> Redmi AC2100(桥接& 提供wifi)
> 主路由 192.168.100.1

## 组网

1. 家里所有设备在同一网段，正常上网（包括科学上网）
2. 商云App可以查看AP状态与管理所有AP

### 方案一：TP-Link 作为二级路由

N3540仍然做主路由，Lan口接AC交换机的Wan口，AC Wan口自动获取Ip 或者静态IP都可，Lan口开启DHCP。

* 优点：该方案是可用的，商云APP可以正常发现并管理AP设备，配置简单现有网络基础上不需要做太多的变化，只需替换原来的Redmi 路由器即可
* 缺点：不满足我的需求1，主路由与AP不在同一网段。多一级路由对网络传输会有损耗也增加了网络的复杂度

总结：该方案不推荐

### 方案二：TP-Link AC 仅作为交换机使用

AC交换机先不接上游网络（Wan先不接线）Lan口连接所有AP,通过wifi或者网线设置AC,AC Wan口可不做设置或设置自动获取IP，AC Lan口设置静态IP（与主路由保持同一网段如：192.168.100.233）并关闭DHCP服务。N3540仍然做主路由，最后N3540Lan口接AC交换机的Lan口。

* 优点：整个网络只有主路由提供DHCP服务，所以所有设备均在同一网段，且所有设备能正常上网并跑满带宽
* 缺点：由于AC Wan口没有使用仅作为交换机，所有没有接入互联网不能使用商云APP(咨询了客服是这样解释的)也就不能通过商云app 管理AP,但是

可以通过AC IP(192.168.100.233)进入网页UI进行查看网络情况
总结：方案可行，没有强迫症对商云APP没有执念可以尝试

### 方案三：N3540做旁路由（也叫旁路网关）

经过前面两种方案的尝试，方案都并不完美，最终通过一番搜索与学习，最终决定将主路由用作旁路由，AC升级作为主路由。
首先光猫网线出来直接接入ACWan口，进入路由器控制中心Wan口输入账号密码进行拨号,Lan口设置静态IP(如：192.168.100.233),开启DHCP.
image.png
N3540做旁路由Lan口接入AC Lan口，修改设置：

  1. Lan口选择静态地址（与AC主路由保持网段一致，如192.168.100.1）；网关设置成AC 主路由地址（192.168.100.233）这很重要。
  2. Lan口关闭DHCP服务
  3. 进入防火墙，修改Lan 防火墙设置，勾选“IP 动态伪装”
至此N3540设置完毕。至此N3540仅作为一个网络设备不会对整个网络有任何影响。连接APwifi 手机等设备也能正常上网，但是还不能科学上网。

还要进行一部配置，将联网设备的网关指向旁路由。该配置有两种方式：非侵入式与侵入式

  1. 非侵入式：联网设备进行联网配置，自动获取IP改为手动设置 需要特殊注意的是将网关配置成旁路由IP（即192.168.100.1）重新连接后即可上网。该方案优点就是可以控制哪些设备需要经旁路由。缺点就是比较麻烦 每个需要科学上网的设备都需要手动配置，
  2. 侵入式：基于上面一种方案，该方案是将该配置通过DHCP下发给所有联网设备，在AC Lan口的DHCP配置中填入旁路由IP（即192.168.100.1）所有设备重新联网即可。该方案也有缺点，有侵入性，如果旁路由挂掉 整个网络即瘫痪（该场景应该很少）

至此所有配置完成。

* 优点：满足我的两点基本需求。所有设备正常上网，跑满带宽。商云APP 正常发现并管理AP设备
* 缺点：配置稍微麻烦一点

总结：目前是我的最佳解决方案，推荐。如果后续有方案变更再做更新。有小伙伴有更好的方式可进行讨论分享[emoji:抱拳]
